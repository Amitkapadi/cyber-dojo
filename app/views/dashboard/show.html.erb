
<script language="JavaScript"
        type="text/javascript"><!--

var id = "<%=@kata.id-%>";

function reParse(event) {
  event.preventDefault();
  var carriageReturn = 13;
  if (event.keyCode == carriageReturn) {
    parseSecondsPerColumn();
    parseMaximumColumns();
    rePost();
  }
}
  
function rePost() {
  $cd.postTo('/dashboard/show', {
    id: id,
    seconds_per_column: seconds_per_column,
    maximum_columns: maximum_columns
  });
}

function refreshDashboard() {
  $j.ajax({
    url: "<%= url_for :action => 'heartbeat', :id => @kata.id %>",
    data: { seconds_per_column: parseSecondsPerColumn(),
               maximum_columns: parseMaximumColumns() },
    dataType: "script"
  });
};

$j(function() {
  setInterval(refreshDashboard, 10000);
});

//--></script>

<table align="center">
  <tr>
    
    <td class="panel" align="center">
      <%= render :partial => 'shared/yin_yang' -%>
      <br/>
      <%= render :partial => 'shared/id' -%>
      <br/>
      <div id="age">
        <%= render :partial => 'age' -%>
      </div>
    </td>
    <td>
      &nbsp;&nbsp;
    </td>
    
    <%= form_tag({ :action => 'show', :id => @kata.id }, :method => 'get') do %>
      <td class="panel" valign="top">
        <%= render :partial => 'seconds_per_column' -%>      
        <%= render :partial => 'maximum_columns' -%>
      </td>
    <% end %>
    
    <td class="panel" valign="top">
      <table>
        <tr>
          <td>
            <%= render :partial => 'shared/feedback' -%>
          </td>
        </tr>
        <tr>
          <td>
            <%= render :partial => 'tips' -%>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<table>
  <tr>
    <td>
      <div class="choose_title" align="center">
        click any traffic light
      </div>      
    </td>
  </tr>
  <tr>
    <td>
      <div id="traffic_lights" 
          class="panel">
        <%= render :partial => 'traffic_lights' -%>
      </div>
    </td>
  </tr>
</table>


