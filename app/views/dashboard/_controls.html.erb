
<script type="text/javascript"><!--

$(document).ready(function() {

  var id = (function() {
    return "<%= @kata.id %>";
  })();

  var minuteColumns = (function() {
    return $('#minute-columns-checkbox');
  })();
  var autoRefresh = (function() {
    return $('#auto-refresh-checkbox');
  })();

  var minuteColumnsIsChecked = function() {
    return minuteColumns.is(':checked');
  };
  var autoRefreshIsChecked = function() {
    return autoRefresh.is(':checked');
  };

  var dashboardHeartbeat = function() {
    if (autoRefreshIsChecked()) {
      $.ajax({
        url: '/dashboard/heartbeat',
        data: {
          id: id,
          minute_columns: minuteColumnsIsChecked(),
          auto_refresh: autoRefreshIsChecked()
        },
        dataType: 'script'
      });
    }
  };

  var refreshDashboard = function() {
    var url = '/dashboard/show/' + id + '?' +
              'minute_columns=' + minuteColumnsIsChecked() + '&' +
              'auto_refresh=' + autoRefreshIsChecked();
    window.location = url;
  };

  var milliSecond = 1;
  var seconds = 1000 * milliSecond;
  setInterval(dashboardHeartbeat, 10*seconds);

  minuteColumns
    .attr('checked', "<%= @minute_columns %>" === "true")
    .click(function() {
      refreshDashboard();
    });

  autoRefresh
    .attr('checked', "<%= @auto_refresh %>" === "true")
    .click(function() {
      refreshDashboard();
    });

});

//--></script>

<table id="controls-container">
  <tr>
    <td>
      <div title="toggles 60-second columns on/off">
        <%= raw t("views.labels.columns") %>
      </div>
    </td>
    <td>
      &nbsp;
    </td>
    <td>
      <input type="checkbox"
             class="regular-checkbox"
             id="minute-columns-checkbox"/>
        <label for="minute-columns-checkbox"></label>
    </td>
  </tr>
  <tr>
    <td>
      <div title="toggle the 10 second auto-refresh on/off">
        <%= raw t('views.labels.auto_refresh') %>
      </div>
    </td>
    <td>
      &nbsp;
    </td>
    <td>
      <input type="checkbox"
             class="regular-checkbox"
             id="auto-refresh-checkbox"/>
        <label for="auto-refresh-checkbox"></label>
    </td>
  </tr>
</table>
