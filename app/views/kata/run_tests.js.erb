
var lights = function() {
  return $('.diff-traffic-light');
};

var lastRag = "<%= @last_rag %>";

//- - - - - - - - - - - - - - - - - - - - - -

var appendNewTrafficLight = function() {
  var img = $('<img>', {
    'src': '/images/bulb_' + lastRag + '.png',
    'alt': lastRag + ' traffic-light'
  });
  var div = $('<div>', {
    'class': 'diff-traffic-light',
    'data-tip':'ajax:traffic_light',
    'data-id': "<%= @kata.id %>",
    'data-avatar-name': "<%= @avatar.name %>",
    'data-colour': lastRag,
    'data-was-tag': lights().size(),
    'data-now-tag': lights().size() + 1
  });
  var td = $('<td>');
  div.append(img);
  td.append(div);
  $('.traffic-lights-count').parent().before(td);
};

//- - - - - - - - - - - - - - - - - - - - - -

appendNewTrafficLight();
cd.updateTrafficLightCount();
cd.updatePieChart();

//cd.setupHoverTips();
//console.log('6');
$('#output')
  .html("<%= js_partial('output') %>");
//console.log('7');

