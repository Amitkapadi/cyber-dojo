
<script language="javascript" type="text/javascript"><!--

$j(document).ready(function() {

  $cd.buildDiffFilenameHandlers(<%= @diffs.to_json.html_safe %>);
  
  $j.fn.onOff = function() {
    var setTo = this.val() === 'none' ? 'block' : 'none';
    this.val(setTo);
    return setTo;
  };

  var allLineCountButtons = $j('.diff-deleted-line-count, .diff-added-line-count');
  var off = { 'disabled':true, 'title':'' }; 
  
  var disableAllLineCountButtons = function() {
    allLineCountButtons.attr(off);
  };

  $j('.filename').click(function() {
    var tr = $j(this).parent().parent();
    var del = tr.find('.diff-deleted-line-count');
    var add = tr.find('.diff-added-line-count');
    disableAllLineCountButtons();
    del.attr('disabled', false)
       .attr('title', 'click to toggle deleted lines on/off');
    add.attr('disabled', false)
       .attr('title', 'click to toggle added lines on/off');
  });

  $j('.diff-deleted-line-count').click(function() {
    if ($j(this).attr('disabled') !== 'disabled') {
      var deleted = $j('deleted');
      deleted.css('display', deleted.onOff());
    }
  });
  
  $j('.diff-added-line-count').click(function() {
    if ($j(this).attr('disabled') !== 'disabled') {
      var added = $j('added');
      added.css('display', added.onOff());
    }
  });
  
  disableAllLineCountButtons();
  $j('#' + '<%= @current_filename_id %>').click();  
  $j('input[type=radio]').hide();
  
});

//--></script>

<table cellpadding="0" cellspacing="0">
  <% @diffs.each do |file| %>
    <% n_deleted = file[:deleted_line_count] %>
    <% n_added   = file[:added_line_count]   %>
    <tr>
      <td align="left">        
        <div class="filename"
             id="<%= file[:id] %>" >
          <input id="radio_<%= file[:id] %>"
                 name="filename"
                 type="radio"
                 checked="checked"
                 value="<%= file[:name] %>"/>
          <label>
            <%= file[:name] %>
          </label>
        </div>
      </td>    
      <% show_delete = (n_deleted > 0) || (n_deleted == 0 && n_added > 0) %>
      <% show_added  = (n_added > 0) || (n_added == 0 && n_deleted > 0) %>
      <td align="left">
        <% if show_delete %>
            <div class="diff-deleted-line-count small button">
              <%= n_deleted %>
            </div>
            
        <% end %>
      </td>
      <td align="left">
        <% if show_added %>
          <div class="diff-added-line-count small button">
            <%= n_added %>
          </div>
        <% end %> 
      </td>      
    </tr>
  <% end %>
</table>
