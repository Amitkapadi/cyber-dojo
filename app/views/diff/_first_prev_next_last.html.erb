
<script language="JavaScript"
        type="text/javascript"><!--

$j(document).ready(function() {

  var minTag = 1;  
  var currentTag = <%= @traffic_lights_to_tag.length %>;
  var maxTag = <%= @all_traffic_lights.length %>;
  
  var showDiff = function(n) {
    if (n !== currentTag) {
      $cd.postTo('/diff/show', {
	id: "<%= @kata.id %>",
	avatar: "<%= @avatar.name %>",
	tag: n
      });
    }
  };

  var tagNumber = function(event) {
    var CARRIAGE_RETURN = 13;
    if (event.keyCode === CARRIAGE_RETURN) {
      var input = $j('#tag_number');
      var newTag = parseInt(input.attr('value'), 10);
      if (!isNaN(newTag)) {
	if (newTag < minTag) { newTag = minTag; }
	if (newTag > maxTag) { newTag = maxTag; }
	return newTag;
      } else {
	input.attr('value', currentTag);
      }
    }    
    return currentTag;
  };
  
  var gotoDiffTitle = function(name,n) {
    return 'Goto ' + name + ' diff (' + n + ')';  
  };
  
  $j('#first_button').click(function()      { showDiff(minTag); });
  $j('#prev_button' ).click(function()      { showDiff(currentTag-1); });
  $j('#tag_number'  ).keyup(function(event) { showDiff(tagNumber(event)); });
  $j('#next_button' ).click(function()      { showDiff(currentTag+1); });
  $j('#last_button' ).click(function()      { showDiff(maxTag); });

  if (currentTag !== 1) {
    $j('#first_button').attr('title', gotoDiffTitle('first',1));
    $j('#prev_button' ).attr('title', gotoDiffTitle('previous', currentTag-1));  
  } else {
    $j('#first_button').attr('disabled', true);
    $j('#prev_button' ).attr('disabled', true);    
  }

  if (currentTag < maxTag) {
    $j('#next_button').attr('title', gotoDiffTitle('next', currentTag+1));
    $j('#last_button').attr('title', gotoDiffTitle('last', maxTag));
  } else {
    $j('#next_button').attr('disabled', true);
    $j('#last_button').attr('disabled', true);
  }

  $j('#tag_number').attr('value', currentTag);
});

//--></script>

<table cellpadding="1" cellspacing="1">
  <tr valign="middle">
    <td>
      <%= render :partial => 'triangle_button', :locals => { :name => 'first' } %>
    </td>                
    <td>
      <%= render :partial => 'triangle_button', :locals => { :name => 'prev' } %>
    </td>
    <td>
      <input type="text"
	     id="tag_number"
	     value="" />
    </td>   
    <td>
      <%= render :partial => 'triangle_button', :locals => { :name => 'next' } %>
    </td>
    <td>
      <%= render :partial => 'triangle_button', :locals => { :name => 'last' } %>
    </td>
  </tr>
</table>      
