
<html>
    <head>
    <style type="text/css">
        body {
            padding-top: 4em;
            padding-left: 8em;
            padding-right: 8em;
        }
        .red   { color: Red;    }
        .amber { color: Orange; }
        .green { color: Green;  }
        .bash {
            font-family: monospace;
            background: Gray;
            color: Black;
            display: block;
            white-space: pre;

        }
        .dockerfile, .json {
            font-family: monospace;
            background: DarkGray;
            color: Black;
            display: block;
            white-space: pre;
        }
    </style>
    </head>
    <body>


<h1>adding a new language and unit-test-framework to cyber-dojo</h1>

This is a two step process.
<ul>
<li>First, create a docker-container for just the language.
This docker-container is unit-test-framework agnostic.</li>
<li>Second, create a docker-container for the language + unit-test-framework
by building a new docker-container on top of the first one.</li>
</ul>

<h2>build a docker-container for <em>just</em> the language</h2>

For example, suppose you were building Lisp-2.3

<ul>
  <li>
    choose a docker-container to build <code>FROM</code>
    <br/>For example
    <code>cyberdojo/build-essential</code>
    at the <a href="https://index.docker.io/u/cyberdojo/">cyberdojo docker index</a>
    which was built using this
    <a href="https://github.com/JonJagger/cyberdojo/blob/master/languages/build-essential/Dockerfile">
    Dockerfile</a>
  </li>
  <li>
    create a new folder underneath the <code>cyberdojo/languages/</code> folder.
    <div class="bash">
    $ md cyberdojo/languages/Lisp-2.3
    </div>
  </li>
  <li>
    in your language's folder, create a file called <code>Dockerfile</code>
    <div class="bash">
    $ touch cyberdojo/languages/Lisp-2.3/Dockerfile
    </div>
    The first line of this file must name the
    docker-container you chose to build <code>FROM</code> in the first step.<br/>
    Add <a href="DOCKERFILE-INDEX-HERE">commands</a> needed to install your language
    prefixed with <code>RUN</code>
    <div class="dockerfile">
    FROM       cyberdojo/build-essential
    RUN apt-get install -y lispy-2.3
    RUN apt-get install -y ...
    ...
    </div>
    See for example...
    <a href="https://github.com/JonJagger/cyberdojo/blob/master/languages/C%23/Dockerfile">
    cyberdojo/languages/C#/Dockerfile
    </a>
  </li>
  <li>
    use the <code>Dockerfile</code> to try and build your docker-container.
    For example
    <div class="bash">
    $ docker build -t cyberdojo/Lisp-2.3 .
    </div>
    which, if it completes, creates a new docker-container
    called <code>cyberdojo/Lisp-2.3</code> using the <code>Dockerfile</code> in
    the current folder <code>.</code>
  </li>
  <li>
    write a script called <code>build-docker-container.sh</code> to automate
    building your language's docker-container
    <div class="bash">
    $ echo cyberdojo/languages/Lisp-2.3/build-docker-container.sh
    #!/bin/bash
    docker build -t cyberdojo/Lisp-2.3 .
    </div>
  </li>
</ul>

<h2>build a docker-container for the language <em>and</em> unit-test-framework</h2>

Repeat the same process, building <code>FROM</code> the docker-container
you created in the previous step.<br/>
For example, suppose your Lisp unit-test framework is called LUnit
<ul>
  <li>
    create a new folder underneath <code>cyberdojo/languages/</code>
    <div class="bash">
    $ md cyberdojo/languages/Lisp-2.3_LUnit
    </div>
    Note that this is under <code>cyberdojo/languages/</code>
    and <em>not</em> under <code>cyberdojo/languages/Lisp-2.3/</code>
  </li>
  <li>
    in your language's folder, create a file called <code>Dockerfile</code>
    <div class="bash">
    $ touch cyberdojo/languages/Lisp-2.3_LUnit/Dockerfile
    </div>
    The first line of this file must name the
    docker image you built for your language above.<br/>
    Add lines for all the commands needed to install your
    unit-test framework prefixed with <code>RUN</code>.
    <div class="dockerfile">
    FROM       cyberdojo/Lisp-2.3
    RUN apt-get install -y lispy-lunit
    RUN apt-get install -y ...
    </div>
    If you do not need any commands you should still create
    a <code>Dockerfile</code> with the single <code>FROM</code> line.
  </li>
  <li>
    use the <code>Dockerfile</code> to try and build your container.
    For example
    <div class="bash">
    $ docker build -t cyberdojo/Lisp-2.3_LUnit .
    </div>
    which, if it completes, creates a new docker container called
    <code>cyberdojo/Lisp-2.3_LUnit</code>
    using the <code>Dockerfile</code>
    in the current folder <code>.</code>
  </li>
  <li>
    write a script called <code>build-docker-container.sh</code> to automate
    building your (language + unit test) docker container
    <div class="bash">
    $ echo cyberdojo/languages/Lisp-2.3_LUnit/build-docker-container.sh
    #!/bin/bash
    docker build -t cyberdojo/Lisp-2.3_LUnit .
    </div>
  </li>
</ul>

<h2>write the <code>manifest.json</code> file</h2>

For example
    <div class="bash">
    $ touch cyberdojo/languages/Lisp-2.3_LUnit/manifest.json
    </div>

Each <code>manifest.json</code> file contains an ruby object in JSON format
<br>Example: the one for Java-1.8_JUnit looks like this:
    <div class="json">
    {
      "visible_filenames": [
        "Hiker.java",
        "HikerTest.java",
        "cyber-dojo.sh"
      ],
      "support_filenames": [
        "junit-4.11.jar"
      ],
      "progress_regexs" : [
        "Tests run\\: (\\d)+,(\\s)+Failures\\: (\\d)+",
        "OK \\((\\d)+ test(s)?\\)"
      ],
      "display_name": "Java, JUnit",
      "unit_test_framework": "junit",
      "image_name": "cyberdojo/java-1.8_junit",
      "tab_size": 4
    }
    </div>

See [Language Manifest](language_manifest.md) for
<code>manifest.json</code> details.


<h2>create the initial files</h2>

For example, for the above <code>manifest.json</code> file you would need
to create three files: <code>Hiker.java</code>,
 <code>HikerTest.java</code>,
 <code>cyber-dojo.sh</code>.
In honour of Douglas Adams these always take the form of a function
called <code>answer()</code> which return <code>6 * 9</code>
and a test for this function which expects <code>42</code>.
Thus the initial files give you a <span class="red">red</span> traffic-light.


<h2>check the language's manifest.json file</h2>

    <div class="bash">
    $ cd /var/www/cyberdojo/test/languages
    $ ./check_one_language.rb &lt;language-name&gt;
    </div>
For example
    <div class="bash">
    $ cd /var/www/cyberdojo/test/languages
    $ ./check_one_language.rb Lisp-2.3
    </div>


<h2>write an output parse function</h2>
 <ul>
  <li>
    Deep-breath...
  <br/>
    the <code>unit_test_framework</code> entry in <code>manifest.json</code>
    names the function inside <code>app/lib/OutputParser.rb</code>
    used to determine if the output from running <code>cyber-dojo.sh</code>,
    in your docker-container, on the animal's current files, qualifies as
    a <span class="red">red</span> traffic-light,
    an <span class="amber">amber</span> traffic-light, or
    a <span class="green">green</span> traffic-light.<br/>
    And exhale...<br/>
    There are lots of examples in
    <a href="https://github.com/JonJagger/cyberdojo/blob/master/app/lib/OutputParser.rb">
    app/lib/OutputParser.rb
    </a>
  </li>
  <li>
    There are lots of example tests in
    <a href="https://github.com/JonJagger/cyberdojo/tree/master/test/app_lib">
    cyberdojo/test/app_lib
    </a>
    eg
    <a href="https://github.com/JonJagger/cyberdojo/blob/master/test/app_lib/test_output_python_pytest.rb">
    test_output_python_pytest.rb
    </a>
  </li>
  <li>
    Of course, if the unit-test framework you're using already exists
    in <code>app/lib/OutputParser.rb</code> you can simply name it and you're done.
  </li>
 </ul>

</body>
</html>
